name: Windows Java CI with WinAppDriver

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Check out code
      uses: actions/checkout@v3

    - name: Set up JDK 8
      uses: actions/setup-java@v3
      with:
        java-version: '8'
        distribution: 'adopt'

    - name: Set up WinAppDriver
      run: |
        $url = "https://github.com/microsoft/WinAppDriver/releases/download/v1.2.1/WindowsApplicationDriver_1.2.1.msi"
        Invoke-WebRequest -Uri $url -OutFile "$env:TEMP\WindowsApplicationDriver.msi"
        Start-Process -Wait -FilePath msiexec -ArgumentList '/i', "$env:TEMP\WindowsApplicationDriver.msi", '/quiet'
        Start-Process -FilePath "C:\Program Files (x86)\Windows Application Driver\WinAppDriver.exe"

    - name: Build and test with Maven
      run: mvn clean test
      env:
        JAVA_HOME: ${{ steps.setup-java.outputs.path }}
